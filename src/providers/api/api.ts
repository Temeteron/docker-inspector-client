import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Rx';
import 'rxjs/add/operator/map';

@Injectable()
export class ApiProvider {
  TIME_TO_REFRESH: number = 2000;              // CONSTANT THAT INDICADES HOW OFTEN WE REFRESH COMPONENTS
  baseApiUrl = 'http://localhost:3000';        // SERVER ADDRESS TO MAKE REQUESTS

  constructor(public http: HttpClient) {}

///////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////// GET //////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// GET STATS OF CONTAINER
///////////////////////////////////////////////////////////////////////////
  getStatsOfContainer(id): Observable<any> {

    return this.http.get(`${this.baseApiUrl}/get_stats_of_container/${id}`);
  }

///////////////////////////////////////////////////////////////////////////
// GET STATS OF CONTAINER
///////////////////////////////////////////////////////////////////////////
  getLogsOfContainer(id): Observable<any> {

    return this.http.get(`${this.baseApiUrl}/get_logs_of_container/${id}`);
  }

///////////////////////////////////////////////////////////////////////////
// GET LIST OF CONTAINERS
///////////////////////////////////////////////////////////////////////////
  getListOfContainers(): any {

    return this.http.get(`${this.baseApiUrl}/get_list_of_containers`);
  }

///////////////////////////////////////////////////////////////////////////
// GET LIST AVAILABLE IMAGES
///////////////////////////////////////////////////////////////////////////
  getListOfImages(): Observable<any> {

    return this.http.get(`${this.baseApiUrl}/get_list_of_images`);
  }

///////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// POST //////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// PULL DOCKER IMAGE BY NAME
///////////////////////////////////////////////////////////////////////////
  pullImage(repo_name): Observable<any> {
    let data = { repo_name: repo_name };

    return this.http.post(`${this.baseApiUrl}/pull_docker`, data);
  }

///////////////////////////////////////////////////////////////////////////
// DELETE DOCKER IMAGE BY NAME
///////////////////////////////////////////////////////////////////////////
  deleteImage(repo_name): Observable<any> {
    let data = { repo_name: repo_name };

    return this.http.post(`${this.baseApiUrl}/delete_docker`, data);
  }

///////////////////////////////////////////////////////////////////////////
// CREATE CONTAINER FROM SPECIFIED IMAGE NAME (enhariharan/infinite-loop)
///////////////////////////////////////////////////////////////////////////
  createContainer(repo_name): Observable<any> {
    let data = { repo_name: repo_name };

    return this.http.post(`${this.baseApiUrl}/create_container`, data);
  }

///////////////////////////////////////////////////////////////////////////
// START CONTAINER
///////////////////////////////////////////////////////////////////////////
  startContainer(id): Observable<any> {
    return this.http.post(`${this.baseApiUrl}/start_container/${id}`, {});
  }

///////////////////////////////////////////////////////////////////////////
// STOP CONTAINER
///////////////////////////////////////////////////////////////////////////
  stopContainer(id): Observable<any> {
    return this.http.post(`${this.baseApiUrl}/stop_container/${id}`, {});
  }

///////////////////////////////////////////////////////////////////////////
// DELETE CONTAINER
///////////////////////////////////////////////////////////////////////////
  deleteContainer(id): Observable<any> {
    return this.http.post(`${this.baseApiUrl}/delete_container/${id}`, {});
  }

}
